<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Booking History</title>
  <style>
    :root{
      --bg:#0b0f15;--card:#121826;--muted:#9aa4b2;--text:#e5e7eb;--accent:#4f46e5;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;--chip:#1f2937;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0f15,#0e121a 40%,#0b0f15);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .container{max-width:1100px;margin-inline:auto;padding:28px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    h1{font-size:1.6rem;margin:0}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0 24px}
    input,button{border:1px solid #1f2a3a;background:#0e1420;color:var(--text);padding:10px 12px;border-radius:12px}
    input{min-width:260px}
    button{cursor:pointer}
    button.primary{background:var(--accent);border-color:transparent}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #1c2433;border-radius:18px;padding:16px;box-shadow:0 8px 28px rgba(0,0,0,.35)}
    .card h3{margin:0 0 6px;font-size:1.1rem}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .status{padding:6px 10px;border-radius:999px;font-size:.8rem;font-weight:600;background:var(--chip);border:1px solid #2b364a}
    .status.PAID{background:rgba(16,185,129,.12);color:#8cf0c4;border-color:rgba(16,185,129,.35)}
    .status.PENDING{background:rgba(245,158,11,.12);color:#f7ce8f;border-color:rgba(245,158,11,.35)}
    .status.CANCELED{background:rgba(239,68,68,.12);color:#f7a3a3;border-color:rgba(239,68,68,.35)}
    .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .chip{font-size:.78rem;padding:6px 8px;border:1px solid #2b364a;border-radius:999px;color:#cbd5e1;background:#121827}
    .total{margin-left:auto;font-weight:700}
    .card footer{display:flex;align-items:center;gap:10px;margin-top:12px}
    .pill{padding:6px 10px;border-radius:10px;background:#0e1420;border:1px solid #1e2a3d;color:#cbd5e1}
    .error,.empty,.loading{border:1px dashed #2a364a;border-radius:16px;padding:14px;text-align:center;color:var(--muted)}
    .loading{animation:pulse 1.5s ease-in-out infinite}
    @keyframes pulse{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}
    .small{font-size:.85rem}
    .ghost{opacity:.7}
    .id{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:.75rem;color:#9fb0c7}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M4 7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7Z" stroke="#9aa4b2" stroke-width="1.2"/><path d="M7 9h10M7 13h10M7 17h6" stroke="#9aa4b2" stroke-width="1.2" stroke-linecap="round"/></svg>
      <h1>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (History Booking)</h1>
    </header>

    <div class="controls">
      <input id="userIdInput" placeholder="‡πÉ‡∏™‡πà User ID (‡πÄ‡∏ä‡πà‡∏ô 6645dcd7-...)"/>
      <button id="loadBtn" class="primary">‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
      <button id="demoBtn">‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
    </div>

    <div id="state"></div>
    <section id="list" class="grid" aria-live="polite"></section>
  </div>

  <script>
    // üëâ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á endpoint ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: GET /booking/history/:user_id
    const API_BASE = "https://stadiumhub.onrender.com/api/v1"; // ‡πÄ‡∏ä‡πà‡∏ô "https://api.example.com" (‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏ì)

    const el = {
      userId: document.getElementById('userIdInput'),
      load: document.getElementById('loadBtn'),
      demo: document.getElementById('demoBtn'),
      list: document.getElementById('list'),
      state: document.getElementById('state'),
    };

    function formatTHB(n){
      if(n==null) return "-";
      return new Intl.NumberFormat('th-TH',{style:'currency',currency:'THB',maximumFractionDigits:0}).format(n);
    }

    function toThaiDate(iso){
      try{
        const d = new Date(iso);
        return d.toLocaleString('th-TH',{ timeZone:'Asia/Bangkok', year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit' });
      }catch(e){ return iso; }
    }

    function trimSeat(s){ return (s||'').trim(); }

    function normalizeBookings(payload){
      // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö {data: {...}} (1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) ‡πÅ‡∏•‡∏∞ {data: [...]} (‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
      if(!payload) return [];
      const d = payload.data;
      if(Array.isArray(d)) return d;
      if(d && typeof d === 'object') return [d];
      return [];
    }

    function renderState(kind, msg){
      el.state.innerHTML = `<div class="${kind}">${msg}</div>`;
    }

    function clearState(){ el.state.innerHTML = ''; }

    function renderList(bookings){
      if(!bookings.length){
        el.list.innerHTML = '';
        renderState('empty','‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á');
        return;
      }
      clearState();
      const html = bookings.map(b=>{
        const match = b.Match || {}; 
        const home = match.HomeTeam?.Name || '-';
        const away = match.AwayTeam?.Name || '-';
        const when = match.UTCDate ? toThaiDate(match.UTCDate) : '-';
        const venue = match.Venue || match.HomeTeam?.Venue || '-';
        const seats = (b.seats||[]).map(s=>trimSeat(s.seat_no)).filter(Boolean);
        const seatChips = seats.slice(0,6).map(s=>`<span class="chip" title="${s}">${s}</span>`).join('');
        const extra = seats.length>6 ? `<span class="chip ghost">+${seats.length-6}</span>`:'';
        const status = b.status || 'UNKNOWN';
        const total = b.total_price;
        const kickOff = match.UTCDate || '';
        const id = b.id || b.ID || '';

        return `
          <article class="card" aria-label="booking card">
            <div class="row">
              <h3>${home} <span class="muted">vs</span> ${away}</h3>
              <span class="status ${status}">${status}</span>
            </div>
            <div class="small muted">${venue}</div>
            <div class="small">${when}</div>

            <div class="chips">${seatChips}${extra}</div>

            <footer>
              <span class="pill">‡∏ï‡∏±‡πã‡∏ß: ${(b.seats||[]).length} ‡πÉ‡∏ö</span>
              <span class="pill">‡∏Ñ‡∏¥‡∏Å‡∏≠‡∏≠‡∏ü (UTC): ${kickOff ? new Date(kickOff).toUTCString().slice(5,22) : '-'}</span>
              <span class="total">${formatTHB(total)}</span>
            </footer>
            <div class="id" title="Booking ID">${id}</div>
          </article>`;
      }).join('');
      el.list.innerHTML = html;
    }

    async function loadHistory(userId){
      if(!userId){
        renderState('error','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà User ID');
        return;
      }
      renderState('loading','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
      el.list.innerHTML = '';
      try{
        const url = `${API_BASE}/booking/history/${encodeURIComponent(userId)}`;
        const res = await fetch(url,{headers:{'Accept':'application/json'}});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();
        const bookings = normalizeBookings(payload);
        renderList(bookings);
      }catch(err){
        console.error(err);
        renderState('error',`‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${err.message}`);
      }
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î
    el.load.addEventListener('click',()=>{
      loadHistory(el.userId.value.trim());
    });

    // ‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤ (single booking) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    el.demo.addEventListener('click',()=>{
      const demo = {"message":"get booking success","data":{"id":"edfb1476-94ef-4481-9891-0e5bd98464f0","user_id":"6645dcd7-a693-4723-ae12-76a09e135c90","User":{"ID":"6645dcd7-a693-4723-ae12-76a09e135c90","CreatedAt":"2025-10-28T17:52:19.843599Z","UpdatedAt":"2025-10-28T18:33:38.419779Z","DeletedAt":null,"Username":"beam1784","FirstName":"Arnuphap","LastName":"Uthaiwong","Email":"arnuphapbeamgenshin02@gmail.com","Password":"","PhoneNumber":"0123456789","Role":"user"},"match_id":537881,"Match":{"ID":537881,"HomeTeamID":65,"HomeTeam":{"ID":65,"Name":"Manchester City FC","ShortName":"Man City","TLA":"MCI","Address":"SportCity Manchester M11 3FF","Venue":"Etihad Stadium","ViewerCapacity":55097,"Price":3800,"CreatedAt":"2025-10-25T17:50:04.731356Z","UpdatedAt":"2025-10-25T17:51:52.283446Z"},"AwayTeamID":1044,"AwayTeam":{"ID":1044,"Name":"AFC Bournemouth","ShortName":"Bournemouth","TLA":"BOU","Address":"Dean Court, Kings Park Bournemouth BH7 7AF","Venue":"Vitality Stadium","ViewerCapacity":11464,"Price":2500,"CreatedAt":"2025-10-25T17:50:06.010265Z","UpdatedAt":"2025-10-25T17:51:51.256576Z"},"UTCDate":"2025-11-02T16:30:00Z","Status":"TIMED","Venue":"Etihad Stadium","CreatedAt":"2025-10-28T21:31:52.746365Z","UpdatedAt":"2025-10-28T21:31:52.773153Z"},"total_price":22800,"status":"PAID","seats":[{"seat_id":"15693864-ab29-447b-a8a1-f4799494476f","seat_no":"n-121       ","price":3800},{"seat_id":"16948340-256f-4a92-91bc-a5938772e2d8","seat_no":"n-120       ","price":3800},{"seat_id":"2657c8ba-566f-4928-b3f5-00a57ab7a167","seat_no":"n-122       ","price":3800},{"seat_id":"5f6b3203-fe52-46a9-a85c-2f98b4e1d843","seat_no":"n-124       ","price":3800},{"seat_id":"a96d0296-38cb-458d-a949-96dda54b0d6d","seat_no":"n-12        ","price":3800},{"seat_id":"cbe17685-3ecc-4138-9477-19f820af7d5f","seat_no":"n-123       ","price":3800}],"created_at":"2025-10-28T17:56:10.083906Z","updated_at":"2025-10-28T17:57:32.674882Z"}};
      clearState();
      renderList(normalizeBookings(demo));
    });

    // UX: Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î
    el.userId.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ el.load.click(); }});
  </script>
</body>
</html>
